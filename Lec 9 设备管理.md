# Lec 9 设备管理

### I/O硬件

+ 设备类型

	- 字符型设备
	
	- 块存储设备
	
	- 网络设备
	
+ I/O控制方式

	- 程序控制I/O(轮询方式)
	
		> 处理器代表给I/O模块发送一个I/O命令,该进程进入忙式等待(busy-waiting),等待操作的完成,然后才可以继续操作
	
	- 中断驱动I/O
		
		> 处理器代表进程向I/O模块发出一个I/O命令,然后继续执行后续指令,当I/O模块完成工作后,处理器被该模块中断
	
	- 直接存储器访问(DMA)
	
		+ DMA直接代替了CPU
		
		+ 利用CPU不访问存储器的周期来实现周期挪用
		
		+ 类型
		
			- 单总线,分离的DMA
			
			- 单总线,集成的DMA-I/O
			
			- 可选择的DMA配置
		
	- 通道方式
	
		> CPU在执行主程序时遇到I/O请求,它启动指定通道上选址的外围设备,一旦启动成功,通道开始控制外围设备进行操作,CPU就可执行其他任务并与通道并行工作, 直到I/O操作完成,通道发出操作结束中断时,CPU才停止当前工作,转向处理I/O操作结束事件
		
		+ 通道状态字(CSW):用于记录通道和设备执行操作的情况
		
		+ 输入输出指令
		
			- 启动输入输出指令(SIO)
			
			- 查询输入输出指令(TIO)
			
			- 查询通道指令(TCH)
			
			- 停止输入输出指令(HIO)
			
			- 停止设备指令(HDV)
		
		+ 通道地址字(CAW):存放通道程序首地址
			
		+ 处理步骤
			
			- 组织通道程序,送CAW
			
			- 执行输入输出命令启动通道工作
			
			- 形成条件码,若通道可用从CAW取得首地址得到第一条指令后启动通道控制器
			
			- 检查设备状态后若设备不忙释放CPU
			
			- 执行通道程序
			
			- 完成后形成CSW和置中断字寄存器,发出输入输出中断让CPU处理
			
### I/O缓冲

+ 类型

	- 面向块:磁盘和磁带
	
	- 面向流:终端,打印机,通信接口
	
+ 单缓冲

	> 操作系统在主存中为I/O请求分配一个缓冲区

	- 面向块:输入传送的数据被放到缓冲区中,当传送完成时,进程把该块移动到用户空间,并立即请求另一块,这种方式成为超前(预先输入)
	
	- 面向流:每次传送一行的方式或者每次传送一个字节
	
+ 双缓冲

	> 在一个进程往一个缓冲区中传送数据(从这个缓冲区取数据)的同时,操作系统正在清空(或者填充)另一个缓冲区 
	
+ 循环缓冲

### 独占型外围设备的分配

+ 设备分类
	
	- 从特性分:独占设备,共享设备,虚拟设备
	
	- 从管理分配外围设备技术分:独占方式,共享方式,虚拟方式
	
+ 分配方式

	- 静态分配方式
	
	- 动态分配方式

	- 设备类表:设备类,总台数,空闲台数,设备表起始地址

	- 设备表

### 共享型设备的驱动调度

+ 磁盘(Slides: pp37-40)

+ 磁盘调度策略

	- FIFO

	- Priority

	- LIFO

	- SSTF:选择使磁头臂从当前位置开始移动最少的磁盘I/O请求

	- SCAN

	- LOOK

+ RAID0-6

+ Cache

	- LRU

	- LFU:替换集合中被访问次数最少的块

### 虚拟设备

+ 井(Slides: p65)

	> 用作缓冲的存储区域

	+ 预输入程序

	+ 缓输出程序

	+ 井管理程序

###  I/O设备管理的实现与层次

+ I/O软件

	- 用户层I/O软件

	- 与设备无关的操作系统I/O软件

	- 设备驱动程序

	- I/O中断处理程序(底层)