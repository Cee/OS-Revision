# Lec 3 中断

### 寄存器与指令

+ 处理器寄存器

	- 用户可见寄存器
	
		+ 数据寄存器
		
		+ 地址寄存器
		
		+ 条件码寄存器: 处理器硬件为操作结果设置的位
	
	- 控制和状态寄存器
	
		+ 程序计数器: 将取指令的地址

		+ 指令寄存器: 最近使用的指令内容

		+ 中断寄存器
	
+ 特权指令和处理器状态

	- 核心状态
	
	- 管理状态
	
	- 用户状态 
	
+ 程序状态字(Program Status Word)

	- 程序计数器,指令寄存器,条件码

	- 中断字,中断允许/禁止位

	- 核心态/用户态 

	- 保护位

+ 流水线(Pipeline)

### 中断与中断源

> 中断: 暂时中止CPU上现行程序的运行,转去执行相应的事件处理程序,处理完成后再返回原程序被中断处或者调度其他程序执行的过程

+ 中断源

	- 硬件故障,程序性中断,外部中断,I/O中断
	
	- 自愿性中断事件

### 中断处理

+ 响应

	- 发现中断源,提出中断请求

		+ 发现内容非零的中断寄存器

		+ 决定这些中断是否应该屏蔽

		+ 当有多个要响应的中断源时,根据规定的优先级选取一个

		+ 把中断字送到当前PSW的中断码字段

	- 中断当前程序的执行

		+ 保存当前程序的PSW到内存约定单元

	- 启动操作系统的中断处理程序
		
		+ 从内存约定单元取出中断处理程序的PSW

+ 处理

	- 保护未被硬件保护的一些必需的处理状态
	
	- 通过分析被中断进程的PSW中断码字段,识别中断源

	- 分别处理发生的中断事件

	- 恢复正常操作

###  中断的优先级和多重中断

+ 因素

	- 中断屏蔽可以使中断装置不响应某些中断

	- 中断优先级决定了中断装置响应中断的次序

	- 中断可以嵌套处理, 但嵌套的层数应有限制

	- 中断的嵌套处理改变了中断处理的次序
	
+ 多重中断类型

	- 顺序中断
	
	- 嵌套中断