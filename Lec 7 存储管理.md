#Lec 7 存储管理

###内存管理的需求

+ 进程重定位
	
	- 可用的主存空间通常被许多进程共享
	
	- 提供一个巨大的就绪进程池,能够把活动进程换入或换出主存,以便使处理器的利用率最大化
	
	- 操作系统需要知道进程控制信息和执行栈以及该进程开始执行程序的入口点的位置
	
+ 内存保护

	- 每个进程都应该保护
	
	- 满足重定位的需求增加了保护需求的难度(不可预测)
	
	- 必须在运行时检查存储器访问权限
	
+ 内存共享

	- 允许多个进程访问主存的同一部分
	
+ 内存逻辑组织

	- 模块可以独立编写和编译
	
	- 模块可以被多个进程共享

+ 内存物理组织

###内存分区

+ 固定分区(大小相等或者不等)
	
	- 小于或等于分区容量的任何进程都可以进入分区
	
	- 分区满了后可以换出进程
	
	- 主存的利用率非常低
	
+ 动态分区
	
	- 适配算法
	
		+ 最佳适配:选择与要求大小最接近的
		
		+ 首次适配:从低地址开始扫描,选择大小足够的第一个可用快
		
		+ 邻近适配:从上一次放置位置开始扫描,选择打造足够的第一个可用块
		
		+ 最坏适配:扫描整个未分配区表或链表,总是挑选一个最大的空闲区

+ 伙伴系统(Buddy System)

+ 内存不足的存储管理技术

	- 移动技术
	
	- 对换技术
	
	- 覆盖技术
	###分段管理
> 目的是为了模块化程序设计
> 分页存储管理:一维地址结构 分段存储管理:二维地址结构
+ 程序和相关的数据被划分成一组段(Segment)		- 逻辑地址:段号和偏移量
	- 段表:段的长度,段的起始地址,其他控制位与标志位
+ 分段和分页的比较
	- 分段是信息的逻辑单位,段长可根据用户需要来规定,段起始地址可从任何主存地址开始
	- 分页是信息的物理单位,页长由系统确定,页面只能以页大小的整倍数地址开始###分页管理

+ 分页

	- 主存被划分成大小固定相等的块,且块相对比较小,每个进程也被分成同样大小的小块	- 进程中称为页(page)的块可以指定到内存中称为页框(frame)或者页框的可用块	- 仅有一个简单的基址寄存器是不够的,操作系统需要为每个进程维护一个页表(page table)
+ 多级页表
	- 反置页表
		+ 页号
		+ 进程标识符
		+ 控制位
		+ 链指针
+ 分页存储空间的页面共享和保护
	- 数据共享
	- 程序共享###Cache
+ TLB(Translation Lookaside Buffer,转移后备缓冲器)(Slides: pp85-86)

	- 计算(Slides: pp88-89)
	+ 直接映射和关联映射(Slides: p91)

+ Cache和Memory的存储结构(Slides: p93)

+ Cache映射

	- 直接映射(Slides: p99)
		
		+ J = I mod 2^c
		
		+ 每个缓存块j可以和若干个主存块对应
		
		+ 每个主存块i只能和一个缓存块对应
	
	- 全关联映射(Slides: p102)
	
		+ m = t + c(主存字块标记) b(字块内地址)
		
		+ 主存中的任一块可以映射到缓存中的任一块
	
	- 组关联映射(Slides: p107)
	
		+ 上述两种方案的折衷
		
		+ j = (i mod 2^c') × 2^r +k 0 ≦ k ≦ 2^r-1
		
		+ 把Cache分成2^C’组,每组有2^r个字块,则主存字块i映射到cache的j块上+ Cache替换算法
	- 程序局部性原理:空间时间局部性
	- FIFO
	- LRU:替换主存中上次使用距离当前最远的页
+ Cache写策略:写回,写直达,写一次