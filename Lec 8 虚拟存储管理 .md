# Lec 8 虚拟存储管理

### 虚拟存储概念

> 在具有层次结构存储器的计算机系统中,采用自动实现部分装入和部分替换功能,能从逻辑上为用户提供一个比物理主存容量大得多的,可寻址的一种“主存储器”

+ 和对换的区别

	- 对换以进程为单位
	
	- 虚存管理以页或段为单位
	
+ 部分装入
	
	- 在主存中保留多个进程
	
	- 进程可以比主存的全部空间大
	
+ 抖动

	> 如果一块正好将要被用到之前扔出,操作系统有不得不很快把它取回来,太多的这类操作会导致一种称为系统抖动的情况
	
### 虚拟分页技术

+ 基本原理

	- 每个进程有自己的页表,当所有页都装入主存时,页表被创建并装入主存
	
	- 页表项包含有与主存中的页相对应的页框号

+ 存储管理单元(MMU)

	- 功能
	
		+ 管理硬件页表基址寄存器
		
		+ 分解逻辑地址

		+ 管理快表TLB
		
		+ 访问页表

		+ 发出缺页中断或越界中断,并将控制权交给内核存储管理处理
	
		+ 设置和检查页表中各个特征位
	
	- 过程(Slides: pp23-25)

+ 页尺寸

	- 页越小内部碎布越少
	
	- 页的数目就越多
	
+ 多级页表(上一节)
	
### 虚拟分段技术

> 分段允许程序员把内存看成是由多个地址空间或段组成的

> 段的大小是不相等的,并且是动态的

> 简化不断增长的数据结构的处理

+ 段错误处理(Slides: p49)

+ 分段和分页结合(Slides: p50)

### 虚拟分页的操作系统软件

+ 读取策略

	- 读取策略确定一页何时取入主存

	- 请求式分页

	- 预约式分页

+ 放置策略

	- 放置策略决定一个进程块驻留在实存中的什么地方

+ 替换策略

	- OPT(Belady算法,不可能实现):选择替换下次访问距当前时间最长的那些页

	- FIFO:循环方式移动页

	- LRU:替换主存中上次使用距离当前最远的页

	- CLOCK
		
		+ 某页第一次装入,使用位为1
		
		+ 随后被访问到,使用位为1
		
		+ 当一页被替换,指针指向下一帧,当需要替换时扫描缓冲区查找使用位为0的一帧
		
		+ 当遇到一个使用位为1的帧时,置为0
		
		+ 若扫描完所有位都为1,全置为0后替换最初的位置的那一页

+ 驻留集管理(Slides: p70)
	
	- 局部最佳页面替换算法
	
		+ 不论发生缺页与否,算法在每一步要考虑引用串,如果该页面在时间间隔(t,t+τ)内未被再次引用,那么就移出,否则,该页被保留在进程驻留集中
		
		+ 滑动窗口
		
	- 工作集置换算法
	
		+ 在某一段时间间隔内进程运行所需访问的页面集合,W(t,Δ)表示在时刻t-Δ到时刻t之间(t-Δ,t)所访问的页面集合,进程在时刻t的工作集
		
		+ Δ:工作集窗口尺寸

+ 清楚策略

	- 相反于读取策略

	- 请求式

	- 预约式